---
title       : Class07
subtitle    : Dimension Reduction
author      : Yu-Ru Lin
job         : 
framework   : shower        # {io2012, html5slides, shower, dzslides, ...}
highlighter : highlight.js  # {highlight.js, prettify, highlight}
hitheme     : tomorrow      # 
widgets     : [mathjax]            # {mathjax, quiz, bootstrap}
mode        : selfcontained # {standalone, draft}
knit        : slidify::knit2slides
toc         : true
toc_depth   : 2

--- #toc
## Class07
  
* [Set up](#set-up)
* [PCA process](#pca)
* [PCA on protein consumption data](#pca1)
* [SVD](#svd)
* [MDS](#mds)
* [MDS on protein consumption data](#mds1)

--- #set-up .modal 

## Install R packages
```{r, eval=FALSE}
## this tutorial uses the following packages
```

--- #pca .compact
## PCA process
   * Center the data according to the mean
   * Calculate the covariance matrix
   * Calculate the eigenvectors and eigenvalues of the covariance matrix
   * Express the scaled data in terms of eigenvectors (principal components)

--- .scode-nowrap .compact
## PCA
```{r}
data.url = 'http://www.yurulin.com/class/spring2014_datamining/data/data_text'
data = read.csv(sprintf("%s/unemp.csv",data.url))
data[1:3,]
dim(data)
```

--- .scode-nowrap .compact
## PCA
```{r, dependson=c(-1)}
states = data[,1]; n = length(states)
data = (as.matrix(data[,-1]))
## 1) Center the data according to the mean
my.scaled.data = apply(data,2,function(x) (x-mean(x)))
plot(my.scaled.data,cex=0.9,col="blue",main="Plot of Scaled Data")
```

--- .scode-nowrap .compact
## PCA
```{r, dependson=c(-1)}
## 2) Calculate the covariance matrix
my.cov = cov(my.scaled.data)
my.cov
```


--- .scode-nowrap .compact
## PCA
```{r, dependson=c(-1)}
## 3) Calculate the eigenvectors and eigenvalues of the covariance matrix
my.eigen = eigen(my.cov)
my.eigen
```

--- .scode-nowrap .compact
## PCA
```{r, dependson=c(-1)}
## 3a) Plot the Eigenvectors over the scaled data
plot(my.scaled.data,cex=0.9,col="blue",main="Plot of Scaled Data")
pc1.slope = my.eigen$vectors[2,1] /my.eigen$vectors[1,1]
pc2.slope = my.eigen$vectors[2,2] /my.eigen$vectors[1,2]
abline(0,pc1.slope,col="red")
abline(0,pc2.slope,col="green")
```

--- .scode-nowrap .compact
## PCA
```{r, dependson=c(-1)}
## 4) Express the scaled data in terms of eigenvectors (principal components)
## get the P matrix (loadings, i.e., a matrix whose columns contain the eigenvectors)
loadings = my.eigen$vectors 
## project data onto the loadings
scores = my.scaled.data %*% loadings 
## plot the projected data on the first two PCs
plot(scores,ylim=c(-3,3),main='Data in terms of EigenVectors / PCs',xlab='PC1',ylab='PC2')
abline(0,0,col="red")
abline(0,90,col="green")
```

--- .scode-nowrap .compact #pca1
## PCA on protein consumption data
```{r, dependson=c(-1)}
## load the data:
data.url = 'http://www.yurulin.com/class/spring2014_datamining/data/data_text'
food = read.csv(sprintf("%s/protein.csv",data.url))
food[1:3,] ## take a look at the first three rows
```

--- .ssscode-nowrap .compact 
## PCA on protein consumption data
```{r, dependson=c(-1)}
## correlation matrix
## we strip the first column (country labels) from the data set
cor(food[,-1])
```

--- .ssscode-nowrap .compact 
## PCA on protein consumption data
```{r, dependson=c(-1)}
## scale = TRUE: variables are first standardized. Default is FALSE
pcafood = prcomp(food[,-1], scale=TRUE) 
pcafood
```

--- .ssscode-nowrap .compact 
## PCA on protein consumption data
```{r, dependson=c(-1)}
## the loadings (i.e., a matrix whose columns contain the eigenvectors)
pcafood$rotation
```

--- .ssscode-nowrap .compact 
## PCA on protein consumption data
```{r, dependson=c(-1)}
## use 'predict' to project data onto the loadings
foodpc = predict(pcafood)
foodpc  
```

--- .scode-nowrap .compact 
## PCA on protein consumption data
```{r, dependson=c(-1)}
## how many principal components do we need?
## plot the variances against the number of the principal component;
## retain only factors with eigenvalues greater than 1
plot(pcafood, main="") ## same as screeplot(pcafood)
mtext(side=1, "European Protein Principal Components",  line=1, font=2)
```

--- .scode-nowrap .compact 
## PCA on protein consumption data
```{r, dependson=c(-1),fig.width=6, fig.height=5}
## how do the PCs look?
plot(foodpc[,1:2], type="n", xlim=c(-4,5))
text(x=foodpc[,1], y=foodpc[,2], labels=food$Country)
```

--- .scode-nowrap .compact 
## PCA on protein consumption data
```{r, dependson=c(-1),fig.width=6, fig.height=5}
plot(foodpc[,3:4], type="n", xlim=c(-3,3))
text(x=foodpc[,3], y=foodpc[,4], labels=food$Country)
```

--- .sscode-nowrap .compact 
## PCA on protein consumption data
```{r, dependson=c(-1)}
pcafood$rotation[,1]
```

--- .scode-nowrap .compact 
## PCA on protein consumption data
```{r, dependson=c(-1),fig.width=7, fig.height=5}
## plot both the observations and variables of a matrix
biplot(pcafood)
```

--- #svd .ssscode-nowrap .compact
## SVD
* on a simple term-doc matrix example
```{r}
## 9 documents and 12 terms
docs = c(
  "Human machine interface for Lab ABC computer applications",
  "A survey of user opinion of computer system response time",
  "The EPS user interface management system",
  "System and human system engineering testing of EPS",
  "Relation of user-perceived response time to error measurement",
  "The generation of random, binary, unordered trees",
  "The intersection graph of paths in trees",
  "Graph minors IV: Widths of trees and well-quasi-ordering",
  "Graph minors: A survey"
)
terms = c(
  "human",
  "interface",
  "computer",
  "user",
  "system",
  "response",
  "time",
  "EPS",
  "survey",
  "trees",
  "graph",
  "minors"
)
data = c(
  1, 0, 0, 1, 0, 0, 0, 0, 0 ,
  1, 0, 1, 0, 0, 0, 0, 0, 0 ,
  1, 1, 0, 0, 0, 0, 0, 0, 0 ,
  0, 1, 1, 0, 1, 0, 0, 0, 0 ,
  0, 1, 1, 2, 0, 0, 0, 0, 0 ,
  0, 1, 0, 0, 1, 0, 0, 0, 0 ,
  0, 1, 0, 0, 1, 0, 0, 0, 0 ,
  0, 0, 1, 1, 0, 0, 0, 0, 0 ,
  0, 1, 0, 0, 0, 0, 0, 0, 1 ,
  0, 0, 0, 0, 0, 1, 1, 1, 0 ,
  0, 0, 0, 0, 0, 0, 1, 1, 1 ,
  0, 0, 0, 0, 0, 0, 0, 1, 1 
)
## construct term-doc matrix
tdm = matrix(data,nrow=12,ncol=9,byrow=T)
dim(tdm)
```

--- .scode-nowrap .compact 
## SVD
```{r, dependson=c(-1)}
rownames(tdm) = terms
tdm
```

--- .scode-nowrap .compact 
## SVD
```{r, dependson=c(-1)}
## perform svd
S = svd(tdm,nu=2,nv=2)
u = S$u; s = S$d; v = S$v
rownames(u) = terms
rownames(v) = docs
cat("scale:"); s
```

--- .ssscode-nowrap .compact 
## SVD
```{r, dependson=c(-1)}
cat("term vector:"); u
```

--- .ssscode-nowrap .compact 
## SVD
```{r, dependson=c(-1)}
cat("doc vector:"); v
```

--- .scode-nowrap .compact  #mds
## MDS
on a toy example
```{r, dependson=c(-1)}
set.seed(851982) # To make sure results are consistent
ex.matrix = matrix(sample(c(-1, 0, 1), 24, replace = TRUE),
                   nrow = 4,
                   ncol = 6)
row.names(ex.matrix) = c('A', 'B', 'C', 'D')
colnames(ex.matrix) = c('P1', 'P2', 'P3', 'P4', 'P5', 'P6')
ex.matrix ## a customer-product matrix
```

--- .scode-nowrap .compact 
## MDS
```{r, dependson=c(-1)}
t(ex.matrix) ## a product-customer matrix
```

--- .scode-nowrap .compact 
## MDS
```{r, dependson=c(-1)}
## convert matrix to customer-by-customer matrix
ex.mult = ex.matrix %*% t(ex.matrix)
ex.mult
```

--- .scode-nowrap .compact 
## MDS
```{r, dependson=c(-1)}
## calculate distance between A and D
sqrt(sum((ex.mult[1, ] - ex.mult[4, ]) ^ 2))
```

--- .scode-nowrap .compact 
## MDS
```{r, dependson=c(-1)}
## calculate distance matrix
ex.dist = dist(ex.mult)
ex.dist
```

--- .scode-nowrap .compact 
## MDS
```{r, dependson=c(-1)}
## visualize clusters
ex.mds <- cmdscale(ex.dist)
plot(ex.mds, type = 'n')
text(ex.mds, c('A', 'B', 'C', 'D'))
```

--- .sscode-nowrap .compact #mds
## MDS on protein consumption data
```{r, dependson=c(-1)}
## load the data:
data.url = 'http://www.yurulin.com/class/spring2014_datamining/data/data_text'
food = read.csv(sprintf("%s/protein.csv",data.url))
food[1:3,] ## take a look at the first three rows
```

--- .ssscode-nowrap .compact 
## MDS on protein consumption data
```{r, dependson=c(-1)}
## calculate distance matrix
country.dist = dist(food[,-1])
country.dist
```

--- .ssscode-nowrap .compact 
## MDS on protein consumption data
```{r, dependson=c(-1)}
## visualize clusters
country.mds <- cmdscale(country.dist)
country.mds 
```

--- .scode-nowrap .compact 
## MDS on protein consumption data
```{r, dependson=c(-1)}
plot(country.mds, type = 'n')
text(country.mds, labels=food$Country)
```

--- .scode-nowrap .compact 
## MDS on protein consumption data
```{r, dependson=c(-1)}
```
